2025-04-15 10:18:40,703 - werkzeug - WARNING -  * Debugger is active!
2025-04-15 10:18:40,706 - werkzeug - INFO -  * Debugger PIN: 691-175-853
2025-04-15 10:18:46,452 - Review.reviews.lc3wp_review - INFO - Loading EOD data...
2025-04-15 10:18:47,129 - Review.reviews.lc3wp_review - INFO - Loading reference data...
2025-04-15 10:18:56,936 - Review.reviews.lc3wp_review - WARNING - Removed 18750 duplicate rows from cdp_climate_df
2025-04-15 10:18:56,939 - Review.reviews.lc3wp_review - INFO - Adding Free Float data...
2025-04-15 10:18:56,974 - Review.reviews.lc3wp_review - INFO - Adding ICB Subsector data...
2025-04-15 10:18:56,994 - Review.reviews.lc3wp_review - WARNING - Removed 9315 duplicate rows from ICB data
2025-04-15 10:18:57,224 - Review.reviews.lc3wp_review - INFO - Debug file saved to C:\Users\CSonneveld\OneDrive - Euronext\Documents\Projects\GUI + Reviews\debug\universe_df_after_nace_20250415_101857.xlsx
2025-04-15 10:18:57,225 - Review.reviews.lc3wp_review - INFO - Adding CDP Climate data...
2025-04-15 10:18:57,229 - Review.reviews.lc3wp_review - INFO - Adding Oekom Trust & Carbon data...
2025-04-15 10:18:57,233 - Review.reviews.lc3wp_review - INFO - Adding NACE data...
2025-04-15 10:18:57,236 - Review.reviews.lc3wp_review - INFO - Adding EU Taxonomy flag...
2025-04-15 10:18:57,237 - Review.reviews.lc3wp_review - INFO - Checking GAFI lists and Non-fiscally cooperative countries...
2025-04-15 10:18:57,238 - Review.reviews.lc3wp_review - INFO - Applying exclusion criteria...
2025-04-15 10:18:57,258 - Review.reviews.lc3wp_review - INFO - Marked 149 companies (10%) with worst SG scores for exclusion
2025-04-15 10:18:57,281 - Review.reviews.lc3wp_review - INFO - Calculating Climate Score for ranking...
2025-04-15 10:18:57,283 - Review.reviews.lc3wp_review - INFO - Selecting EU Taxonomy companies...
2025-04-15 10:18:57,284 - Review.reviews.lc3wp_review - INFO - Found 14 EU Taxonomy companies after exclusions
2025-04-15 10:18:57,286 - Review.reviews.lc3wp_review - INFO - Found 979 Non-EU Taxonomy eligible companies after exclusions
2025-04-15 10:18:57,286 - Review.reviews.lc3wp_review - INFO - STEP 4a: Determining target number of Non-EU Taxonomy companies per super-sector...
2025-04-15 10:18:57,287 - Review.reviews.lc3wp_review - INFO - Target number of Non-EU Taxonomy companies: 286
2025-04-15 10:18:57,288 - Review.reviews.lc3wp_review - INFO - Total eligible Non-EU Taxonomy companies: 979
2025-04-15 10:18:57,288 - Review.reviews.lc3wp_review - INFO - Total target after rounding: 295 (vs. target of 286)
2025-04-15 10:18:57,289 - Review.reviews.lc3wp_review - INFO - Need to remove 9 companies due to rounding up
2025-04-15 10:18:57,290 - Review.reviews.lc3wp_review - INFO - STEP 4b: Selecting Non-EU Taxonomy companies based on climate score...
2025-04-15 10:18:57,291 - Review.reviews.lc3wp_review - INFO - Selected 39 companies from super-sector 1010.0
2025-04-15 10:18:57,291 - Review.reviews.lc3wp_review - INFO - Selected 12 companies from super-sector 1510.0
2025-04-15 10:18:57,292 - Review.reviews.lc3wp_review - INFO - Selected 34 companies from super-sector 2010.0
2025-04-15 10:18:57,293 - Review.reviews.lc3wp_review - INFO - Selected 24 companies from super-sector 3010.0
2025-04-15 10:18:57,294 - Review.reviews.lc3wp_review - INFO - Selected 21 companies from super-sector 3020.0
2025-04-15 10:18:57,295 - Review.reviews.lc3wp_review - INFO - Selected 19 companies from super-sector 3030.0
2025-04-15 10:18:57,296 - Review.reviews.lc3wp_review - INFO - Selected 24 companies from super-sector 3510.0
2025-04-15 10:18:57,297 - Review.reviews.lc3wp_review - INFO - Selected 6 companies from super-sector 4010.0
2025-04-15 10:18:57,298 - Review.reviews.lc3wp_review - INFO - Selected 17 companies from super-sector 4020.0
2025-04-15 10:18:57,299 - Review.reviews.lc3wp_review - INFO - Selected 5 companies from super-sector 4030.0
2025-04-15 10:18:57,299 - Review.reviews.lc3wp_review - INFO - Selected 8 companies from super-sector 4040.0
2025-04-15 10:18:57,300 - Review.reviews.lc3wp_review - INFO - Selected 11 companies from super-sector 4050.0
2025-04-15 10:18:57,301 - Review.reviews.lc3wp_review - INFO - Selected 15 companies from super-sector 4510.0
2025-04-15 10:18:57,302 - Review.reviews.lc3wp_review - INFO - Selected 8 companies from super-sector 4520.0
2025-04-15 10:18:57,303 - Review.reviews.lc3wp_review - INFO - Selected 6 companies from super-sector 5010.0
2025-04-15 10:18:57,303 - Review.reviews.lc3wp_review - INFO - Selected 33 companies from super-sector 5020.0
2025-04-15 10:18:57,304 - Review.reviews.lc3wp_review - INFO - Selected 6 companies from super-sector 5510.0
2025-04-15 10:18:57,305 - Review.reviews.lc3wp_review - INFO - Selected 5 companies from super-sector 5520.0
2025-04-15 10:18:57,306 - Review.reviews.lc3wp_review - INFO - Selected 2 companies from super-sector 6510.0
2025-04-15 10:18:57,315 - Review.reviews.lc3wp_review - INFO - Initial selection has 295 companies, need to remove 9
2025-04-15 10:18:57,337 - Review.reviews.lc3wp_review - INFO - Removed company US38141G1040 from supersector 3020.0 (Climate Score: 2.75)
2025-04-15 10:18:57,343 - Review.reviews.lc3wp_review - INFO - Removed company AU000000ANZ3 from supersector 3010.0 (Climate Score: 2.75)
2025-04-15 10:18:57,350 - Review.reviews.lc3wp_review - INFO - Removed company CA0679011084 from supersector 5510.0 (Climate Score: 2.58973159003276)
2025-04-15 10:18:57,356 - Review.reviews.lc3wp_review - INFO - Removed company JP3539220008 from supersector 3030.0 (Climate Score: 2.5)
2025-04-15 10:18:57,362 - Review.reviews.lc3wp_review - INFO - Removed company US7475251036 from supersector 1010.0 (Climate Score: 2.30023900135313)
2025-04-15 10:18:57,367 - Review.reviews.lc3wp_review - INFO - Removed company US2538681030 from supersector 3510.0 (Climate Score: 2.26099033267267)
2025-04-15 10:18:57,372 - Review.reviews.lc3wp_review - INFO - Removed company JP3705200008 from supersector 4050.0 (Climate Score: 2.24552928645429)
2025-04-15 10:18:57,377 - Review.reviews.lc3wp_review - INFO - Removed company DE0005552004 from supersector 5020.0 (Climate Score: 2.220375488488155)
2025-04-15 10:18:57,382 - Review.reviews.lc3wp_review - INFO - Removed company US4595061015 from supersector 5520.0 (Climate Score: 2.2099302264427454)
2025-04-15 10:18:57,384 - Review.reviews.lc3wp_review - INFO - Final Non-EU Taxonomy selection has 286 companies
2025-04-15 10:18:57,385 - Review.reviews.lc3wp_review - INFO - Minimum companies per supersector: 2
2025-04-15 10:18:57,388 - Review.reviews.lc3wp_review - INFO - Final selection contains 300 companies
2025-04-15 10:18:57,388 - Review.reviews.lc3wp_review - INFO - - EU Taxonomy: 14
2025-04-15 10:18:57,388 - Review.reviews.lc3wp_review - INFO - - Non-EU Taxonomy: 286
2025-04-15 10:18:57,389 - Review.reviews.lc3wp_review - INFO - Adding PAB flag based on CDP temperature score...
2025-04-15 10:18:57,389 - Review.reviews.lc3wp_review - INFO - Calculating liquidity constraints for all companies...
2025-04-15 10:18:57,389 - Review.reviews.lc3wp_review - INFO - Total FFMC_WD for all companies: 10315096042807.99
2025-04-15 10:18:57,390 - Review.reviews.lc3wp_review - INFO - Market cap based weights calculated for EU Taxonomy companies
2025-04-15 10:18:57,391 - Review.reviews.lc3wp_review - INFO - Liquidity caps for EU Taxonomy companies - Max: 4.5067%, Min: 0.5423%, Avg: 1.7218%
2025-04-15 10:18:57,391 - Review.reviews.lc3wp_review - INFO - Liquidity floors for EU Taxonomy companies - Max: 0.0000%, Min: 0.0000%, Avg: 0.0000%
2025-04-15 10:18:57,392 - Review.reviews.lc3wp_review - INFO - No liquidity issues found for EU Taxonomy companies
2025-04-15 10:18:57,393 - Review.reviews.lc3wp_review - ERROR - Error during review calculation: 'FFMC_wd'
2025-04-15 10:18:57,397 - Review.reviews.lc3wp_review - ERROR - Traceback (most recent call last):
  File "C:\Users\CSonneveld\AppData\Roaming\Python\Python312\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'FFMC_wd'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\CSonneveld\OneDrive - Euronext\Documents\Projects\GUI + Reviews\Review\reviews\lc3wp_review.py", line 862, in run_lc3wp_review
    non_eu_taxonomy_selection['WIG'] = non_eu_taxonomy_selection['FFMC_wd'] / total_ffmc_wd
                                       ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\CSonneveld\AppData\Roaming\Python\Python312\site-packages\pandas\core\frame.py", line 4102, in __getitem__
    indexer = self.columns.get_loc(key)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\CSonneveld\AppData\Roaming\Python\Python312\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'FFMC_wd'

2025-04-15 10:18:57,431 - werkzeug - INFO - 127.0.0.1 - - [15/Apr/2025 10:18:57] "POST /calculate HTTP/1.1" 200 -
2025-04-15 10:19:37,794 - werkzeug - INFO -  * Detected change in 'C:\\Users\\CSonneveld\\OneDrive - Euronext\\Documents\\Projects\\GUI + Reviews\\Review\\reviews\\lc3wp_review.py', reloading
2025-04-15 10:19:37,801 - werkzeug - INFO -  * Detected change in 'C:\\Users\\CSonneveld\\OneDrive - Euronext\\Documents\\Projects\\GUI + Reviews\\Review\\reviews\\lc3wp_review.py', reloading
2025-04-15 10:19:37,801 - werkzeug - INFO -  * Detected change in 'C:\\Users\\CSonneveld\\OneDrive - Euronext\\Documents\\Projects\\GUI + Reviews\\Review\\reviews\\lc3wp_review.py', reloading
2025-04-15 10:19:38,733 - werkzeug - INFO -  * Detected change in 'C:\\Users\\CSonneveld\\OneDrive - Euronext\\Documents\\Projects\\GUI + Reviews\\Review\\reviews\\lc3wp_review.py', reloading
