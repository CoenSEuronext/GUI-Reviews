2025-11-06 14:44:37,658 - werkzeug - WARNING -  * Debugger is active!
2025-11-06 14:44:37,667 - werkzeug - INFO -  * Debugger PIN: 691-175-853
2025-11-06 14:44:37,700 - werkzeug - INFO - 127.0.0.1 - - [06/Nov/2025 14:44:37] "POST /calculate HTTP/1.1" 200 -
2025-11-06 14:44:37,703 - Review.reviews.aetaw_review - INFO - Loading EOD data...
2025-11-06 14:44:37,706 - werkzeug - INFO - 127.0.0.1 - - [06/Nov/2025 14:44:37] "GET /task-status/37af88bb-6e54-42de-a808-af1667c1a0ea HTTP/1.1" 200 -
2025-11-06 14:44:39,717 - werkzeug - INFO - 127.0.0.1 - - [06/Nov/2025 14:44:39] "GET /task-status/37af88bb-6e54-42de-a808-af1667c1a0ea HTTP/1.1" 200 -
2025-11-06 14:44:41,703 - werkzeug - INFO - 127.0.0.1 - - [06/Nov/2025 14:44:41] "GET /task-status/37af88bb-6e54-42de-a808-af1667c1a0ea HTTP/1.1" 200 -
2025-11-06 14:44:42,718 - Review.reviews.aetaw_review - INFO - Loading reference data...
2025-11-06 14:44:42,933 - Review.reviews.aetaw_review - INFO - Loaded 75 companies from AEX, AMX, and AScX
2025-11-06 14:44:42,971 - utils.capping_2_step - INFO - 
========== STEP 1: Cap all companies at 9% ==========
2025-11-06 14:44:42,971 - utils.capping_2_step - INFO - 
--- Step 1, Iteration 1 ---
2025-11-06 14:44:42,972 - utils.capping_2_step - INFO - Capped 3 companies at 9%
2025-11-06 14:44:42,972 - utils.capping_2_step - INFO - Excess weight: 23.81%
2025-11-06 14:44:42,973 - utils.capping_2_step - INFO - Redistributed to 72 companies below 9%
2025-11-06 14:44:42,973 - utils.capping_2_step - INFO -   WARNING: 2 companies now ABOVE 9% after redistribution
2025-11-06 14:44:42,973 - utils.capping_2_step - INFO - Max weight change: 15.1920%
2025-11-06 14:44:42,973 - utils.capping_2_step - INFO - 
--- Step 1, Iteration 2 ---
2025-11-06 14:44:42,973 - utils.capping_2_step - INFO - Capped 2 companies at 9%
2025-11-06 14:44:42,973 - utils.capping_2_step - INFO - Excess weight: 0.49%
2025-11-06 14:44:42,973 - utils.capping_2_step - INFO - Redistributed to 70 companies below 9%
2025-11-06 14:44:42,973 - utils.capping_2_step - INFO - Max weight change: 0.3883%
2025-11-06 14:44:42,973 - utils.capping_2_step - INFO - 
--- Step 1, Iteration 3 ---
2025-11-06 14:44:42,973 - utils.capping_2_step - INFO - Max weight change: 0.0000%
2025-11-06 14:44:42,973 - utils.capping_2_step - INFO - [SUCCESS] Step 1 converged after 3 iterations
2025-11-06 14:44:42,973 - utils.capping_2_step - INFO - 
Step 1 complete: 5 companies at 9%
2025-11-06 14:44:42,973 - utils.capping_2_step - INFO - 
========== STEP 2: Apply collective constraint (36% rule) ==========
2025-11-06 14:44:42,977 - utils.capping_2_step - INFO - Top 4 companies by initial market cap (protected at 9%):
2025-11-06 14:44:42,977 - utils.capping_2_step - INFO -   1. 7: Initial 24.19%, After Step 1: 9.00%
2025-11-06 14:44:42,977 - utils.capping_2_step - INFO -   2. 25: Initial 15.05%, After Step 1: 9.00%
2025-11-06 14:44:42,977 - utils.capping_2_step - INFO -   3. 27: Initial 11.57%, After Step 1: 9.00%
2025-11-06 14:44:42,977 - utils.capping_2_step - INFO -   4. 24: Initial 6.33%, After Step 1: 9.00%
2025-11-06 14:44:42,977 - utils.capping_2_step - INFO - 
--- Step 2, Iteration 1 ---
2025-11-06 14:44:42,978 - utils.capping_2_step - INFO - Capped 3 companies (outside top 4) to 4.5%
2025-11-06 14:44:42,978 - utils.capping_2_step - INFO - Excess weight: 9.01%
2025-11-06 14:44:42,979 - utils.capping_2_step - INFO - Redistributed to 71 companies at/below 4.5%
2025-11-06 14:44:42,979 - utils.capping_2_step - INFO - Max weight change: 3.2106%
2025-11-06 14:44:42,979 - utils.capping_2_step - INFO - 
--- Step 2, Iteration 2 ---
2025-11-06 14:44:42,980 - utils.capping_2_step - INFO - Capped 3 companies (outside top 4) to 4.5%
2025-11-06 14:44:42,980 - utils.capping_2_step - INFO - Excess weight: 3.18%
2025-11-06 14:44:42,980 - utils.capping_2_step - INFO - Redistributed to 71 companies at/below 4.5%
2025-11-06 14:44:42,981 - utils.capping_2_step - INFO -   WARNING: 1 companies (outside top 4) now ABOVE 4.5% after redistribution
2025-11-06 14:44:42,981 - utils.capping_2_step - INFO -       3: 4.37% -> 4.56%
2025-11-06 14:44:42,982 - utils.capping_2_step - INFO - Max weight change: 0.8335%
2025-11-06 14:44:42,982 - utils.capping_2_step - INFO - 
--- Step 2, Iteration 3 ---
2025-11-06 14:44:42,982 - utils.capping_2_step - INFO - Capped 4 companies (outside top 4) to 4.5%
2025-11-06 14:44:42,982 - utils.capping_2_step - INFO - Excess weight: 1.18%
2025-11-06 14:44:42,982 - utils.capping_2_step - INFO - Redistributed to 71 companies at/below 4.5%
2025-11-06 14:44:42,984 - utils.capping_2_step - INFO - Max weight change: 0.2863%
2025-11-06 14:44:42,984 - utils.capping_2_step - INFO - 
--- Step 2, Iteration 4 ---
2025-11-06 14:44:42,985 - utils.capping_2_step - INFO - Capped 4 companies (outside top 4) to 4.5%
2025-11-06 14:44:42,985 - utils.capping_2_step - INFO - Excess weight: 0.49%
2025-11-06 14:44:42,985 - utils.capping_2_step - INFO - Redistributed to 71 companies at/below 4.5%
2025-11-06 14:44:42,985 - utils.capping_2_step - INFO - Max weight change: 0.0995%
2025-11-06 14:44:42,985 - utils.capping_2_step - INFO - 
--- Step 2, Iteration 5 ---
2025-11-06 14:44:42,985 - utils.capping_2_step - INFO - Capped 4 companies (outside top 4) to 4.5%
2025-11-06 14:44:42,987 - utils.capping_2_step - INFO - Excess weight: 0.20%
2025-11-06 14:44:42,987 - utils.capping_2_step - INFO - Redistributed to 71 companies at/below 4.5%
2025-11-06 14:44:42,988 - utils.capping_2_step - INFO - Max weight change: 0.0411%
2025-11-06 14:44:42,988 - utils.capping_2_step - INFO - 
--- Step 2, Iteration 6 ---
2025-11-06 14:44:42,988 - utils.capping_2_step - INFO - Capped 4 companies (outside top 4) to 4.5%
2025-11-06 14:44:42,988 - utils.capping_2_step - INFO - Excess weight: 0.08%
2025-11-06 14:44:42,989 - utils.capping_2_step - INFO - Redistributed to 71 companies at/below 4.5%
2025-11-06 14:44:42,989 - utils.capping_2_step - INFO - Max weight change: 0.0170%
2025-11-06 14:44:42,990 - utils.capping_2_step - INFO - 
--- Step 2, Iteration 7 ---
2025-11-06 14:44:42,990 - utils.capping_2_step - INFO - Capped 4 companies (outside top 4) to 4.5%
2025-11-06 14:44:42,990 - utils.capping_2_step - INFO - Excess weight: 0.03%
2025-11-06 14:44:42,991 - utils.capping_2_step - INFO - Redistributed to 71 companies at/below 4.5%
2025-11-06 14:44:42,992 - utils.capping_2_step - INFO - Max weight change: 0.0070%
2025-11-06 14:44:42,992 - utils.capping_2_step - INFO - 
--- Step 2, Iteration 8 ---
2025-11-06 14:44:42,992 - utils.capping_2_step - INFO - Capped 4 companies (outside top 4) to 4.5%
2025-11-06 14:44:42,992 - utils.capping_2_step - INFO - Excess weight: 0.01%
2025-11-06 14:44:42,992 - utils.capping_2_step - INFO - Redistributed to 71 companies at/below 4.5%
2025-11-06 14:44:42,992 - utils.capping_2_step - INFO - Max weight change: 0.0029%
2025-11-06 14:44:42,992 - utils.capping_2_step - INFO - 
--- Step 2, Iteration 9 ---
2025-11-06 14:44:42,992 - utils.capping_2_step - INFO - Capped 4 companies (outside top 4) to 4.5%
2025-11-06 14:44:42,992 - utils.capping_2_step - INFO - Excess weight: 0.01%
2025-11-06 14:44:42,992 - utils.capping_2_step - INFO - Redistributed to 71 companies at/below 4.5%
2025-11-06 14:44:42,992 - utils.capping_2_step - INFO - Max weight change: 0.0012%
2025-11-06 14:44:42,992 - utils.capping_2_step - INFO - 
--- Step 2, Iteration 10 ---
2025-11-06 14:44:42,992 - utils.capping_2_step - INFO - Capped 4 companies (outside top 4) to 4.5%
2025-11-06 14:44:42,992 - utils.capping_2_step - INFO - Excess weight: 0.00%
2025-11-06 14:44:42,997 - utils.capping_2_step - INFO - Redistributed to 71 companies at/below 4.5%
2025-11-06 14:44:42,997 - utils.capping_2_step - INFO - Max weight change: 0.0005%
2025-11-06 14:44:42,997 - utils.capping_2_step - INFO - 
--- Step 2, Iteration 11 ---
2025-11-06 14:44:42,998 - utils.capping_2_step - INFO - Capped 4 companies (outside top 4) to 4.5%
2025-11-06 14:44:42,998 - utils.capping_2_step - INFO - Excess weight: 0.00%
2025-11-06 14:44:42,999 - utils.capping_2_step - INFO - Redistributed to 71 companies at/below 4.5%
2025-11-06 14:44:42,999 - utils.capping_2_step - INFO - Max weight change: 0.0002%
2025-11-06 14:44:42,999 - utils.capping_2_step - INFO - 
--- Step 2, Iteration 12 ---
2025-11-06 14:44:43,000 - utils.capping_2_step - INFO - Capped 4 companies (outside top 4) to 4.5%
2025-11-06 14:44:43,000 - utils.capping_2_step - INFO - Excess weight: 0.00%
2025-11-06 14:44:43,001 - utils.capping_2_step - INFO - Redistributed to 71 companies at/below 4.5%
2025-11-06 14:44:43,001 - utils.capping_2_step - INFO - Max weight change: 0.0001%
2025-11-06 14:44:43,002 - utils.capping_2_step - INFO - 
--- Step 2, Iteration 13 ---
2025-11-06 14:44:43,002 - utils.capping_2_step - INFO - Capped 4 companies (outside top 4) to 4.5%
2025-11-06 14:44:43,002 - utils.capping_2_step - INFO - Excess weight: 0.00%
2025-11-06 14:44:43,002 - utils.capping_2_step - INFO - Redistributed to 71 companies at/below 4.5%
2025-11-06 14:44:43,002 - utils.capping_2_step - INFO - Max weight change: 0.0000%
2025-11-06 14:44:43,002 - utils.capping_2_step - INFO - 
--- Step 2, Iteration 14 ---
2025-11-06 14:44:43,002 - utils.capping_2_step - INFO - Capped 4 companies (outside top 4) to 4.5%
2025-11-06 14:44:43,002 - utils.capping_2_step - INFO - Excess weight: 0.00%
2025-11-06 14:44:43,002 - utils.capping_2_step - INFO - Redistributed to 71 companies at/below 4.5%
2025-11-06 14:44:43,002 - utils.capping_2_step - INFO - Max weight change: 0.0000%
2025-11-06 14:44:43,002 - utils.capping_2_step - INFO - 
--- Step 2, Iteration 15 ---
2025-11-06 14:44:43,002 - utils.capping_2_step - INFO - Capped 4 companies (outside top 4) to 4.5%
2025-11-06 14:44:43,002 - utils.capping_2_step - INFO - Excess weight: 0.00%
2025-11-06 14:44:43,007 - utils.capping_2_step - INFO - Redistributed to 71 companies at/below 4.5%
2025-11-06 14:44:43,007 - utils.capping_2_step - INFO - Max weight change: 0.0000%
2025-11-06 14:44:43,007 - utils.capping_2_step - INFO - 
--- Step 2, Iteration 16 ---
2025-11-06 14:44:43,008 - utils.capping_2_step - INFO - Capped 4 companies (outside top 4) to 4.5%
2025-11-06 14:44:43,008 - utils.capping_2_step - INFO - Excess weight: 0.00%
2025-11-06 14:44:43,008 - utils.capping_2_step - INFO - Redistributed to 71 companies at/below 4.5%
2025-11-06 14:44:43,009 - utils.capping_2_step - INFO - Max weight change: 0.0000%
2025-11-06 14:44:43,009 - utils.capping_2_step - INFO - 
--- Step 2, Iteration 17 ---
2025-11-06 14:44:43,010 - utils.capping_2_step - INFO - Capped 4 companies (outside top 4) to 4.5%
2025-11-06 14:44:43,010 - utils.capping_2_step - INFO - Excess weight: 0.00%
2025-11-06 14:44:43,010 - utils.capping_2_step - INFO - Redistributed to 71 companies at/below 4.5%
2025-11-06 14:44:43,011 - utils.capping_2_step - INFO - Max weight change: 0.0000%
2025-11-06 14:44:43,011 - utils.capping_2_step - INFO - 
--- Step 2, Iteration 18 ---
2025-11-06 14:44:43,012 - utils.capping_2_step - INFO - Capped 4 companies (outside top 4) to 4.5%
2025-11-06 14:44:43,012 - utils.capping_2_step - INFO - Excess weight: 0.00%
2025-11-06 14:44:43,012 - utils.capping_2_step - INFO - Redistributed to 71 companies at/below 4.5%
2025-11-06 14:44:43,012 - utils.capping_2_step - INFO - Max weight change: 0.0000%
2025-11-06 14:44:43,012 - utils.capping_2_step - INFO - [SUCCESS] Step 2 converged after 18 iterations
2025-11-06 14:44:43,012 - utils.capping_2_step - INFO - 
========== Final Results ==========
2025-11-06 14:44:43,012 - utils.capping_2_step - INFO - Companies at 9.00%: 4
2025-11-06 14:44:43,012 - utils.capping_2_step - INFO - Companies at 4.50%: 4
2025-11-06 14:44:43,012 - utils.capping_2_step - INFO - Companies between 4.5% and 9%: 0
2025-11-06 14:44:43,014 - utils.capping_2_step - INFO - Companies at or below 4.5%: 71
2025-11-06 14:44:43,014 - utils.capping_2_step - INFO - Total weight OVER 4.5%: 36.00% (limit: 36.00%)
2025-11-06 14:44:43,014 - utils.capping_2_step - INFO - [SUCCESS] Collective cap satisfied
2025-11-06 14:44:43,014 - utils.capping_2_step - INFO - 
Top 4 companies (by initial market cap) final weights:
2025-11-06 14:44:43,014 - utils.capping_2_step - INFO -   1. 7: 9.00%
2025-11-06 14:44:43,014 - utils.capping_2_step - INFO -   2. 25: 9.00%
2025-11-06 14:44:43,014 - utils.capping_2_step - INFO -   3. 27: 9.00%
2025-11-06 14:44:43,014 - utils.capping_2_step - INFO -   4. 24: 9.00%
2025-11-06 14:44:43,014 - Review.reviews.aetaw_review - INFO - AETAW capping complete. Companies with CF < 1: 74
2025-11-06 14:44:43,020 - Review.reviews.aetaw_review - INFO - Saving AETAW output to: C:\Users\CSonneveld\OneDrive - Euronext\Documents\Projects\GUI + Reviews\output\AETAW_df_20251106_144443.xlsx
2025-11-06 14:44:43,719 - werkzeug - INFO - 127.0.0.1 - - [06/Nov/2025 14:44:43] "GET /task-status/37af88bb-6e54-42de-a808-af1667c1a0ea HTTP/1.1" 200 -
2025-11-06 14:46:39,205 - werkzeug - INFO -  * Detected change in 'C:\\Users\\CSonneveld\\OneDrive - Euronext\\Documents\\Projects\\GUI + Reviews\\utils\\capping_2_step.py', reloading
2025-11-06 14:46:39,205 - werkzeug - INFO -  * Detected change in 'C:\\Users\\CSonneveld\\OneDrive - Euronext\\Documents\\Projects\\GUI + Reviews\\utils\\capping_2_step.py', reloading
