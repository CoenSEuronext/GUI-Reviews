2025-08-12 11:10:28,293 - werkzeug - WARNING -  * Debugger is active!
2025-08-12 11:10:28,295 - werkzeug - INFO -  * Debugger PIN: 691-175-853
2025-08-12 11:10:28,323 - Review.reviews.wifrp_review - INFO - Loading EOD data...
2025-08-12 11:10:29,107 - Review.reviews.wifrp_review - INFO - Loading reference data...
2025-08-12 11:10:39,454 - Review.reviews.wifrp_review - WARNING - Removed 2 duplicate rows from Oekom data
2025-08-12 11:10:39,456 - Review.reviews.wifrp_review - INFO - Adding Index_Currency to stock_eod_df by looking up Index in index_eod_df...
2025-08-12 11:10:39,462 - Review.reviews.wifrp_review - INFO - Added Index_Currency to stock_eod_df. Found 54740 matches.
2025-08-12 11:10:39,471 - Review.reviews.wifrp_review - INFO - Added Index_Currency to stock_co_df. Found 54572 matches.
2025-08-12 11:10:39,473 - Review.reviews.wifrp_review - INFO - Filtering universe to exclude Euronext Paris (XPAR) listings...
2025-08-12 11:10:39,477 - Review.reviews.wifrp_review - INFO - Adding Free Float data...
2025-08-12 11:10:39,479 - Review.reviews.wifrp_review - INFO - Applying exclusion criteria...
2025-08-12 11:10:39,540 - Review.reviews.wifrp_review - WARNING - Removed 9430 duplicate rows from ICB data
2025-08-12 11:10:39,540 - Review.reviews.wifrp_review - INFO - Merging ICB data with 'Supersector Code' column
2025-08-12 11:10:39,590 - Review.reviews.wifrp_review - INFO - Processing sector: 1010.0, region: AS, group size: 45
2025-08-12 11:10:39,590 - Review.reviews.wifrp_review - INFO - Companies in group: 45, to exclude: 8
2025-08-12 11:10:39,590 - Review.reviews.wifrp_review - INFO - Processing sector: 1010.0, region: EU, group size: 22
2025-08-12 11:10:39,590 - Review.reviews.wifrp_review - INFO - Companies in group: 22, to exclude: 4
2025-08-12 11:10:39,590 - Review.reviews.wifrp_review - INFO - Processing sector: 1010.0, region: NA, group size: 83
2025-08-12 11:10:39,590 - Review.reviews.wifrp_review - INFO - Companies in group: 83, to exclude: 16
2025-08-12 11:10:39,590 - Review.reviews.wifrp_review - INFO - Processing sector: 1510.0, region: AS, group size: 12
2025-08-12 11:10:39,590 - Review.reviews.wifrp_review - INFO - Companies in group: 12, to exclude: 2
2025-08-12 11:10:39,604 - Review.reviews.wifrp_review - INFO - Processing sector: 1510.0, region: EU, group size: 17
2025-08-12 11:10:39,604 - Review.reviews.wifrp_review - INFO - Companies in group: 17, to exclude: 3
2025-08-12 11:10:39,605 - Review.reviews.wifrp_review - INFO - Processing sector: 1510.0, region: NA, group size: 10
2025-08-12 11:10:39,607 - Review.reviews.wifrp_review - INFO - Companies in group: 10, to exclude: 1
2025-08-12 11:10:39,607 - Review.reviews.wifrp_review - INFO - Processing sector: 2010.0, region: AS, group size: 29
2025-08-12 11:10:39,608 - Review.reviews.wifrp_review - INFO - Companies in group: 29, to exclude: 5
2025-08-12 11:10:39,608 - Review.reviews.wifrp_review - INFO - Processing sector: 2010.0, region: EU, group size: 40
2025-08-12 11:10:39,608 - Review.reviews.wifrp_review - INFO - Companies in group: 40, to exclude: 7
2025-08-12 11:10:39,608 - Review.reviews.wifrp_review - INFO - Processing sector: 2010.0, region: NA, group size: 44
2025-08-12 11:10:39,608 - Review.reviews.wifrp_review - INFO - Companies in group: 44, to exclude: 8
2025-08-12 11:10:39,608 - Review.reviews.wifrp_review - INFO - Processing sector: 3010.0, region: AS, group size: 29
2025-08-12 11:10:39,608 - Review.reviews.wifrp_review - INFO - Companies in group: 29, to exclude: 5
2025-08-12 11:10:39,615 - Review.reviews.wifrp_review - INFO - Processing sector: 3010.0, region: EU, group size: 43
2025-08-12 11:10:39,620 - Review.reviews.wifrp_review - INFO - Companies in group: 43, to exclude: 8
2025-08-12 11:10:39,620 - Review.reviews.wifrp_review - INFO - Processing sector: 3010.0, region: NA, group size: 20
2025-08-12 11:10:39,622 - Review.reviews.wifrp_review - INFO - Companies in group: 20, to exclude: 3
2025-08-12 11:10:39,623 - Review.reviews.wifrp_review - INFO - Processing sector: 3020.0, region: AS, group size: 15
2025-08-12 11:10:39,624 - Review.reviews.wifrp_review - INFO - Companies in group: 15, to exclude: 2
2025-08-12 11:10:39,625 - Review.reviews.wifrp_review - INFO - Processing sector: 3020.0, region: EU, group size: 31
2025-08-12 11:10:39,626 - Review.reviews.wifrp_review - INFO - Companies in group: 31, to exclude: 6
2025-08-12 11:10:39,627 - Review.reviews.wifrp_review - INFO - Processing sector: 3020.0, region: NA, group size: 32
2025-08-12 11:10:39,627 - Review.reviews.wifrp_review - INFO - Companies in group: 32, to exclude: 6
2025-08-12 11:10:39,627 - Review.reviews.wifrp_review - INFO - Processing sector: 3030.0, region: AS, group size: 15
2025-08-12 11:10:39,629 - Review.reviews.wifrp_review - INFO - Companies in group: 15, to exclude: 2
2025-08-12 11:10:39,630 - Review.reviews.wifrp_review - INFO - Processing sector: 3030.0, region: EU, group size: 29
2025-08-12 11:10:39,631 - Review.reviews.wifrp_review - INFO - Companies in group: 29, to exclude: 5
2025-08-12 11:10:39,631 - Review.reviews.wifrp_review - INFO - Processing sector: 3030.0, region: NA, group size: 23
2025-08-12 11:10:39,632 - Review.reviews.wifrp_review - INFO - Companies in group: 23, to exclude: 4
2025-08-12 11:10:39,633 - Review.reviews.wifrp_review - INFO - Processing sector: 3510.0, region: AS, group size: 49
2025-08-12 11:10:39,633 - Review.reviews.wifrp_review - INFO - Companies in group: 49, to exclude: 9
2025-08-12 11:10:39,633 - Review.reviews.wifrp_review - INFO - Processing sector: 3510.0, region: EU, group size: 21
2025-08-12 11:10:39,633 - Review.reviews.wifrp_review - INFO - Companies in group: 21, to exclude: 4
2025-08-12 11:10:39,633 - Review.reviews.wifrp_review - INFO - Processing sector: 3510.0, region: NA, group size: 22
2025-08-12 11:10:39,633 - Review.reviews.wifrp_review - INFO - Companies in group: 22, to exclude: 4
2025-08-12 11:10:39,633 - Review.reviews.wifrp_review - INFO - Processing sector: 4010.0, region: AS, group size: 16
2025-08-12 11:10:39,638 - Review.reviews.wifrp_review - INFO - Companies in group: 16, to exclude: 3
2025-08-12 11:10:39,638 - Review.reviews.wifrp_review - INFO - Processing sector: 4010.0, region: EU, group size: 11
2025-08-12 11:10:39,639 - Review.reviews.wifrp_review - INFO - Companies in group: 11, to exclude: 2
2025-08-12 11:10:39,640 - Review.reviews.wifrp_review - INFO - Processing sector: 4010.0, region: NA, group size: 4
2025-08-12 11:10:39,641 - Review.reviews.wifrp_review - INFO - Companies in group: 4, to exclude: 0
2025-08-12 11:10:39,641 - Review.reviews.wifrp_review - WARNING - No companies to exclude for sector 4010.0 and region NA
2025-08-12 11:10:39,642 - Review.reviews.wifrp_review - INFO - Processing sector: 4020.0, region: AS, group size: 26
2025-08-12 11:10:39,642 - Review.reviews.wifrp_review - INFO - Companies in group: 26, to exclude: 5
2025-08-12 11:10:39,643 - Review.reviews.wifrp_review - INFO - Processing sector: 4020.0, region: EU, group size: 17
2025-08-12 11:10:39,643 - Review.reviews.wifrp_review - INFO - Companies in group: 17, to exclude: 3
2025-08-12 11:10:39,644 - Review.reviews.wifrp_review - INFO - Processing sector: 4020.0, region: NA, group size: 17
2025-08-12 11:10:39,644 - Review.reviews.wifrp_review - INFO - Companies in group: 17, to exclude: 3
2025-08-12 11:10:39,644 - Review.reviews.wifrp_review - INFO - Processing sector: 4030.0, region: AS, group size: 7
2025-08-12 11:10:39,644 - Review.reviews.wifrp_review - INFO - Companies in group: 7, to exclude: 1
2025-08-12 11:10:39,645 - Review.reviews.wifrp_review - INFO - Processing sector: 4030.0, region: EU, group size: 7
2025-08-12 11:10:39,645 - Review.reviews.wifrp_review - INFO - Companies in group: 7, to exclude: 1
2025-08-12 11:10:39,645 - Review.reviews.wifrp_review - INFO - Processing sector: 4030.0, region: NA, group size: 6
2025-08-12 11:10:39,645 - Review.reviews.wifrp_review - INFO - Companies in group: 6, to exclude: 1
2025-08-12 11:10:39,645 - Review.reviews.wifrp_review - INFO - Processing sector: 4040.0, region: AS, group size: 13
2025-08-12 11:10:39,645 - Review.reviews.wifrp_review - INFO - Companies in group: 13, to exclude: 2
2025-08-12 11:10:39,645 - Review.reviews.wifrp_review - INFO - Processing sector: 4040.0, region: EU, group size: 9
2025-08-12 11:10:39,645 - Review.reviews.wifrp_review - INFO - Companies in group: 9, to exclude: 1
2025-08-12 11:10:39,645 - Review.reviews.wifrp_review - INFO - Processing sector: 4040.0, region: NA, group size: 19
2025-08-12 11:10:39,649 - Review.reviews.wifrp_review - INFO - Companies in group: 19, to exclude: 3
2025-08-12 11:10:39,649 - Review.reviews.wifrp_review - INFO - Processing sector: 4050.0, region: AS, group size: 20
2025-08-12 11:10:39,650 - Review.reviews.wifrp_review - INFO - Companies in group: 20, to exclude: 3
2025-08-12 11:10:39,650 - Review.reviews.wifrp_review - INFO - Processing sector: 4050.0, region: EU, group size: 11
2025-08-12 11:10:39,651 - Review.reviews.wifrp_review - INFO - Companies in group: 11, to exclude: 2
2025-08-12 11:10:39,651 - Review.reviews.wifrp_review - INFO - Processing sector: 4050.0, region: NA, group size: 18
2025-08-12 11:10:39,651 - Review.reviews.wifrp_review - INFO - Companies in group: 18, to exclude: 3
2025-08-12 11:10:39,651 - Review.reviews.wifrp_review - INFO - Processing sector: 4510.0, region: AS, group size: 25
2025-08-12 11:10:39,652 - Review.reviews.wifrp_review - INFO - Companies in group: 25, to exclude: 4
2025-08-12 11:10:39,652 - Review.reviews.wifrp_review - INFO - Processing sector: 4510.0, region: EU, group size: 24
2025-08-12 11:10:39,652 - Review.reviews.wifrp_review - INFO - Companies in group: 24, to exclude: 4
2025-08-12 11:10:39,653 - Review.reviews.wifrp_review - INFO - Processing sector: 4510.0, region: NA, group size: 17
2025-08-12 11:10:39,654 - Review.reviews.wifrp_review - INFO - Companies in group: 17, to exclude: 3
2025-08-12 11:10:39,654 - Review.reviews.wifrp_review - INFO - Processing sector: 4520.0, region: AS, group size: 17
2025-08-12 11:10:39,654 - Review.reviews.wifrp_review - INFO - Companies in group: 17, to exclude: 3
2025-08-12 11:10:39,655 - Review.reviews.wifrp_review - INFO - Processing sector: 4520.0, region: EU, group size: 11
2025-08-12 11:10:39,655 - Review.reviews.wifrp_review - INFO - Companies in group: 11, to exclude: 2
2025-08-12 11:10:39,656 - Review.reviews.wifrp_review - INFO - Processing sector: 4520.0, region: NA, group size: 14
2025-08-12 11:10:39,656 - Review.reviews.wifrp_review - INFO - Companies in group: 14, to exclude: 2
2025-08-12 11:10:39,656 - Review.reviews.wifrp_review - INFO - Processing sector: 5010.0, region: AS, group size: 17
2025-08-12 11:10:39,656 - Review.reviews.wifrp_review - INFO - Companies in group: 17, to exclude: 3
2025-08-12 11:10:39,656 - Review.reviews.wifrp_review - INFO - Processing sector: 5010.0, region: EU, group size: 22
2025-08-12 11:10:39,656 - Review.reviews.wifrp_review - INFO - Companies in group: 22, to exclude: 4
2025-08-12 11:10:39,659 - Review.reviews.wifrp_review - INFO - Processing sector: 5010.0, region: NA, group size: 11
2025-08-12 11:10:39,659 - Review.reviews.wifrp_review - INFO - Companies in group: 11, to exclude: 2
2025-08-12 11:10:39,659 - Review.reviews.wifrp_review - INFO - Processing sector: 5020.0, region: AS, group size: 93
2025-08-12 11:10:39,660 - Review.reviews.wifrp_review - INFO - Companies in group: 93, to exclude: 18
2025-08-12 11:10:39,661 - Review.reviews.wifrp_review - INFO - Processing sector: 5020.0, region: EU, group size: 82
2025-08-12 11:10:39,661 - Review.reviews.wifrp_review - INFO - Companies in group: 82, to exclude: 16
2025-08-12 11:10:39,662 - Review.reviews.wifrp_review - INFO - Processing sector: 5020.0, region: NA, group size: 76
2025-08-12 11:10:39,662 - Review.reviews.wifrp_review - INFO - Companies in group: 76, to exclude: 15
2025-08-12 11:10:39,663 - Review.reviews.wifrp_review - INFO - Processing sector: 5510.0, region: AS, group size: 23
2025-08-12 11:10:39,664 - Review.reviews.wifrp_review - INFO - Companies in group: 23, to exclude: 4
2025-08-12 11:10:39,664 - Review.reviews.wifrp_review - INFO - Processing sector: 5510.0, region: EU, group size: 15
2025-08-12 11:10:39,664 - Review.reviews.wifrp_review - INFO - Companies in group: 15, to exclude: 2
2025-08-12 11:10:39,664 - Review.reviews.wifrp_review - INFO - Processing sector: 5510.0, region: NA, group size: 13
2025-08-12 11:10:39,664 - Review.reviews.wifrp_review - INFO - Companies in group: 13, to exclude: 2
2025-08-12 11:10:39,664 - Review.reviews.wifrp_review - INFO - Processing sector: 5520.0, region: AS, group size: 17
2025-08-12 11:10:39,664 - Review.reviews.wifrp_review - INFO - Companies in group: 17, to exclude: 3
2025-08-12 11:10:39,664 - Review.reviews.wifrp_review - INFO - Processing sector: 5520.0, region: EU, group size: 16
2025-08-12 11:10:39,664 - Review.reviews.wifrp_review - INFO - Companies in group: 16, to exclude: 3
2025-08-12 11:10:39,664 - Review.reviews.wifrp_review - INFO - Processing sector: 5520.0, region: NA, group size: 5
2025-08-12 11:10:39,664 - Review.reviews.wifrp_review - INFO - Companies in group: 5, to exclude: 0
2025-08-12 11:10:39,664 - Review.reviews.wifrp_review - WARNING - No companies to exclude for sector 5520.0 and region NA
2025-08-12 11:10:39,664 - Review.reviews.wifrp_review - INFO - Processing sector: 6010.0, region: AS, group size: 10
2025-08-12 11:10:39,664 - Review.reviews.wifrp_review - INFO - Companies in group: 10, to exclude: 1
2025-08-12 11:10:39,669 - Review.reviews.wifrp_review - INFO - Processing sector: 6010.0, region: EU, group size: 18
2025-08-12 11:10:39,669 - Review.reviews.wifrp_review - INFO - Companies in group: 18, to exclude: 3
2025-08-12 11:10:39,670 - Review.reviews.wifrp_review - INFO - Processing sector: 6010.0, region: NA, group size: 35
2025-08-12 11:10:39,670 - Review.reviews.wifrp_review - INFO - Companies in group: 35, to exclude: 6
2025-08-12 11:10:39,670 - Review.reviews.wifrp_review - INFO - Processing sector: 6510.0, region: AS, group size: 22
2025-08-12 11:10:39,671 - Review.reviews.wifrp_review - INFO - Companies in group: 22, to exclude: 4
2025-08-12 11:10:39,672 - Review.reviews.wifrp_review - INFO - Processing sector: 6510.0, region: EU, group size: 24
2025-08-12 11:10:39,672 - Review.reviews.wifrp_review - INFO - Companies in group: 24, to exclude: 4
2025-08-12 11:10:39,672 - Review.reviews.wifrp_review - INFO - Processing sector: 6510.0, region: NA, group size: 31
2025-08-12 11:10:39,673 - Review.reviews.wifrp_review - INFO - Companies in group: 31, to exclude: 6
2025-08-12 11:10:39,673 - Review.reviews.wifrp_review - INFO - Calculating FFMC for all companies in universe...
2025-08-12 11:10:39,673 - Review.reviews.wifrp_review - INFO - Using Mcap in EUR to calculate FFMC
2025-08-12 11:10:39,673 - Review.reviews.wifrp_review - INFO - Creating rank based on FFMC...
2025-08-12 11:10:39,673 - Review.reviews.wifrp_review - INFO - Found 20 valid exclusion columns: ['exclusion_1', 'exclusion_2', 'exclusion_3', 'exclusion_4', 'exclusion_5', 'exclusion_6', 'exclusion_7', 'exclusion_8', 'exclusion_9', 'exclusion_10', 'exclusion_11', 'exclusion_12', 'exclusion_13', 'exclusion_14', 'exclusion_15', 'exclusion_16', 'exclusion_17', 'exclusion_18', 'exclusion_19', 'exclusion_20']
2025-08-12 11:10:39,690 - Review.reviews.wifrp_review - INFO - Selecting eligible companies...
2025-08-12 11:10:39,699 - Review.reviews.wifrp_review - INFO - Selecting top 40 companies by FFMC...
2025-08-12 11:10:39,700 - Review.reviews.wifrp_review - INFO - Adding Symbol column to final_selection...
2025-08-12 11:10:40,926 - Review.reviews.wifrp_review - INFO - Added Symbol to 40 companies out of 40
2025-08-12 11:10:40,926 - Review.reviews.wifrp_review - INFO - Calculating weights and capping factors using the most recent pricing data...
2025-08-12 11:10:40,934 - Review.reviews.wifrp_review - INFO - Found 1167 records with Index_Currency='EUR' for selected Symbols
2025-08-12 11:10:40,962 - Review.reviews.wifrp_review - INFO - Calculating post-capping weights...
2025-08-12 11:10:40,963 - Review.reviews.wifrp_review - INFO - Creating final output dataframe...
2025-08-12 11:10:40,967 - Review.reviews.wifrp_review - ERROR - Error during review calculation: 'ISIN code'
2025-08-12 11:10:40,975 - werkzeug - INFO -  * Detected change in 'C:\\Users\\CSonneveld\\AppData\\Roaming\\Python\\Python312\\site-packages\\pandas\\core\\frame.py', reloading
2025-08-12 11:10:40,975 - werkzeug - INFO -  * Detected change in 'C:\\Users\\CSonneveld\\AppData\\Roaming\\Python\\Python312\\site-packages\\pandas\\core\\indexes\\base.py', reloading
2025-08-12 11:10:40,975 - Review.reviews.wifrp_review - ERROR - Traceback (most recent call last):
  File "C:\Users\CSonneveld\AppData\Roaming\Python\Python312\site-packages\pandas\core\indexes\base.py", line 3805, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7081, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas\\_libs\\hashtable_class_helper.pxi", line 7089, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'ISIN code'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\CSonneveld\OneDrive - Euronext\Documents\Projects\GUI + Reviews\Review\reviews\wifrp_review.py", line 873, in run_wifrp_review
    analysis_results = inclusion_exclusion_analysis(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\CSonneveld\OneDrive - Euronext\Documents\Projects\GUI + Reviews\utils\inclusion_exclusion.py", line 23, in inclusion_exclusion_analysis
    selection_df['Inclusion'] = selection_df[isin_column].apply(lambda x: x not in isin_set)
                                ~~~~~~~~~~~~^^^^^^^^^^^^^
  File "C:\Users\CSonneveld\AppData\Roaming\Python\Python312\site-packages\pandas\core\frame.py", line 4102, in __getitem__
    indexer = self.columns.get_loc(key)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\CSonneveld\AppData\Roaming\Python\Python312\site-packages\pandas\core\indexes\base.py", line 3812, in get_loc
    raise KeyError(key) from err
KeyError: 'ISIN code'

2025-08-12 11:10:41,027 - werkzeug - INFO - 127.0.0.1 - - [12/Aug/2025 11:10:41] "POST /calculate HTTP/1.1" 200 -
